<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ…ˆæµæµ´ä½› 2026 - Tzu Chi Buddha Bathing Ceremony</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;600;700&family=Noto+Serif:wght@400;600;700&display=swap" rel="stylesheet">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Serif SC', 'Noto Serif', serif;
            background: linear-gradient(180deg, #0a1628 0%, #001233 50%, #000814 100%);
            color: #f8fafc;
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* === å¼€åœºä½›é™€åƒ Overlay === */
        #buddha-overlay {
            position: fixed;
            inset: 0;
            z-index: 1000;
            background: #000814;
            display: flex;
            align-items: center;
            justify-content: center;
            /* æ…¢æ…¢æ¸æ¸æ¶ˆå¤±ï¼š2.5ç§’è¿‡æ¸¡ */
            transition: opacity 2.5s ease-in-out, filter 2.5s ease-in-out;
        }

        #buddha-overlay.fade-out {
            opacity: 0;
            filter: blur(30px);
            pointer-events: none;
        }

        #buddha-overlay img {
            max-width: 100%;
            max-height: 100vh;
            object-fit: contain;
        }

        /* === è¯­è¨€é€‰æ‹© Overlay === */
        #language-overlay {
            position: fixed;
            inset: 0;
            z-index: 900;
            background: linear-gradient(180deg, #0a1628 0%, #001233 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.6s ease-in;
        }

        #language-overlay.active {
            opacity: 1;
            pointer-events: auto;
        }

        #language-overlay.fade-out {
            opacity: 0;
            pointer-events: none;
        }

        .language-title {
            font-size: clamp(1.5rem, 4vw, 2.5rem);
            color: #c9a227;
            margin-bottom: 3rem;
            text-align: center;
            letter-spacing: 0.3em;
        }

        .language-buttons {
            display: flex;
            gap: 2rem;
            flex-wrap: wrap;
            justify-content: center;
        }

        .lang-btn {
            padding: 1.2rem 3rem;
            font-size: 1.3rem;
            font-family: 'Noto Serif SC', serif;
            background: transparent;
            border: 2px solid #c9a227;
            color: #c9a227;
            cursor: pointer;
            transition: all 0.3s ease;
            letter-spacing: 0.2em;
        }

        .lang-btn:hover {
            background: #c9a227;
            color: #000814;
            box-shadow: 0 0 30px rgba(201, 162, 39, 0.4);
        }

        /* === ä¸»å†…å®¹åŒºåŸŸ === */
        #main-content {
            display: none;
            opacity: 0;
            transition: opacity 0.8s ease-in;
        }

        #main-content.active {
            display: block;
            opacity: 1;
        }

        /* === æ ‡é¢˜åŒºåŸŸ === */
        .hero-section {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            text-align: center;
        }

        .main-title {
            font-size: clamp(2.5rem, 10vw, 5rem);
            color: #c9a227;
            letter-spacing: 0.5em;
            margin-bottom: 1rem;
            text-shadow: 0 0 40px rgba(201, 162, 39, 0.5);
            animation: titleGlow 3s ease-in-out infinite alternate;
        }

        @keyframes titleGlow {
            from { text-shadow: 0 0 40px rgba(201, 162, 39, 0.3); }
            to { text-shadow: 0 0 60px rgba(201, 162, 39, 0.6); }
        }

        .sub-title {
            font-size: clamp(1rem, 3vw, 1.5rem);
            color: #94a3b8;
            letter-spacing: 0.3em;
            margin-bottom: 2rem;
        }

        /* === æµ´ä½›æ„ä¹‰æ–‡æ¡ˆ === */
        .ceremony-description {
            max-width: 800px;
            margin: 0 auto 3rem;
            padding: 0 1.5rem;
            text-align: center;
        }

        .ceremony-text {
            color: #cbd5e1;
            font-size: clamp(0.95rem, 2.5vw, 1.1rem);
            line-height: 2;
            margin-bottom: 1.5rem;
        }

        .ceremony-highlight {
            color: #c9a227;
            font-weight: 600;
        }

        .ceremony-section-title {
            color: #c9a227;
            font-size: clamp(1rem, 2.5vw, 1.2rem);
            margin-bottom: 0.8rem;
            letter-spacing: 0.15em;
        }

        /* === è§†é¢‘åŒºåŸŸ === */
        .video-section {
            width: 100%;
            max-width: 900px;
            margin: 0 auto;
            padding: 0 1rem;
        }

        .video-container {
            position: relative;
            width: 100%;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 0 60px rgba(201, 162, 39, 0.2);
            border: 1px solid rgba(201, 162, 39, 0.3);
        }

        .video-container video,
        .video-container iframe {
            width: 100%;
            display: block;
        }

        /* === æ´»åŠ¨åœ°å€ä¿¡æ¯ === */
        .event-info {
            text-align: center;
            margin: 2.5rem auto;
            padding: 1.5rem 2rem;
            max-width: 600px;
            background: rgba(201, 162, 39, 0.08);
            border: 1px solid rgba(201, 162, 39, 0.25);
            border-radius: 12px;
        }

        .event-date {
            font-size: clamp(1.3rem, 4vw, 1.8rem);
            color: #c9a227;
            font-weight: 700;
            letter-spacing: 0.1em;
            margin-bottom: 0.8rem;
        }

        .event-venue-zh {
            font-size: clamp(1rem, 3vw, 1.2rem);
            color: #f8fafc;
            margin-bottom: 0.3rem;
        }

        .event-venue-en {
            font-size: clamp(0.9rem, 2.5vw, 1rem);
            color: #94a3b8;
        }

        /* === å›¾å½¢åŒºåŸŸ === */
        .formation-section {
            padding: 4rem 1rem;
            position: relative;
        }

        .section-title {
            text-align: center;
            font-size: clamp(1.5rem, 5vw, 2.5rem);
            color: #c9a227;
            margin-bottom: 1rem;
            letter-spacing: 0.3em;
        }

        .section-subtitle {
            text-align: center;
            color: #64748b;
            margin-bottom: 3rem;
            font-size: 1rem;
        }

        /* è®¡æ•°å™¨ */
        .stats-container {
            display: flex;
            justify-content: space-between;
            max-width: 1200px;
            margin: 0 auto 2rem;
            padding: 0 1rem;
        }

        .stat-box {
            background: rgba(0, 18, 51, 0.8);
            backdrop-filter: blur(10px);
            padding: 1rem 1.5rem;
            border-radius: 10px;
            border-left: 4px solid;
        }

        .stat-box.left {
            border-color: #c9a227;
        }

        .stat-box.right {
            border-color: #475569;
            text-align: right;
            border-left: none;
            border-right: 4px solid #475569;
        }

        .stat-label {
            font-size: 0.75rem;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 0.3rem;
        }

        .stat-number {
            font-size: clamp(1.5rem, 5vw, 2.5rem);
            font-weight: 700;
            letter-spacing: 0.1em;
        }

        .stat-box.left .stat-number {
            color: #c9a227;
        }

        .stat-box.right .stat-number {
            color: #94a3b8;
        }

        /* SVG å›¾è…¾ */
        .svg-container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            position: relative;
        }

        #main-stage {
            width: 100%;
            height: auto;
            display: block;
        }

        /* ç‚¹æ ·å¼ */
        .dot {
            fill: #1e3a5f;
            opacity: 0.4;
            transition: fill 2s ease-out, opacity 2s ease-out, r 2s ease-out, filter 2s ease-out;
        }

        .dot.active {
            fill: #c9a227;
            opacity: 1;
            r: 3;
            filter: drop-shadow(0 0 4px #c9a227);
        }

        /* Flash Mode */
        .flash-mode .dot {
            fill: #fef3c7 !important;
            opacity: 1 !important;
            r: 2.5 !important;
            filter: drop-shadow(0 0 6px rgba(254, 243, 199, 0.8)) !important;
            transition: none !important;
        }

        .flash-mode .dot.active {
            fill: #c9a227 !important;
            r: 4 !important;
        }

        /* å±å¹•é—ªå…‰ */
        #screen-flash {
            position: fixed;
            inset: 0;
            background: rgba(254, 243, 199, 0.3);
            opacity: 0;
            pointer-events: none;
            z-index: 60;
            transition: opacity 1.5s ease-out;
        }

        #screen-flash.active {
            opacity: 1;
            transition: none;
        }

        /* Loading */
        #loading-spinner {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            color: #c9a227;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(201, 162, 39, 0.3);
            border-top-color: #c9a227;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* === æŠ¥åè¡¨å•åŒºåŸŸ === */
        .registration-section {
            padding: 4rem 1rem;
            background: linear-gradient(180deg, transparent 0%, rgba(0, 18, 51, 0.5) 100%);
        }

        .form-container {
            max-width: 500px;
            margin: 0 auto;
            background: rgba(10, 22, 40, 0.9);
            backdrop-filter: blur(20px);
            padding: 2.5rem;
            border-radius: 16px;
            border: 1px solid rgba(201, 162, 39, 0.2);
            box-shadow: 0 0 40px rgba(0, 0, 0, 0.5);
        }

        .form-title {
            text-align: center;
            font-size: 1.5rem;
            color: #c9a227;
            margin-bottom: 0.5rem;
            letter-spacing: 0.2em;
        }

        .form-subtitle {
            text-align: center;
            color: #64748b;
            margin-bottom: 2rem;
            font-size: 0.9rem;
        }

        .form-group {
            margin-bottom: 1.2rem;
        }

        .form-group label {
            display: block;
            color: #94a3b8;
            font-size: 0.85rem;
            margin-bottom: 0.5rem;
        }

        .form-input {
            width: 100%;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: #fff;
            font-size: 1rem;
            font-family: inherit;
            transition: all 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: #c9a227;
            box-shadow: 0 0 15px rgba(201, 162, 39, 0.2);
        }

        .form-input::placeholder {
            color: #475569;
        }

        select.form-input {
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%2394a3b8' viewBox='0 0 16 16'%3E%3Cpath d='M8 11L3 6h10l-5 5z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 1rem center;
        }

        select.form-input option {
            background: #0a1628;
            color: #fff;
        }

        .submit-btn {
            width: 100%;
            padding: 1.2rem;
            margin-top: 1rem;
            background: linear-gradient(135deg, #b8860b 0%, #c9a227 50%, #daa520 100%);
            border: none;
            border-radius: 8px;
            color: #000;
            font-size: 1.1rem;
            font-weight: 600;
            font-family: inherit;
            letter-spacing: 0.2em;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 0 20px rgba(201, 162, 39, 0.3);
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 30px rgba(201, 162, 39, 0.5);
        }

        .submit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        /* === è§’è‰²é€‰æ‹©æŒ‰é’® === */
        .role-selection {
            margin-bottom: 1.5rem;
        }

        .role-selection label {
            display: block;
            color: #94a3b8;
            font-size: 0.85rem;
            margin-bottom: 0.8rem;
        }

        .role-buttons {
            display: flex;
            gap: 1rem;
        }

        .role-btn {
            flex: 1;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.15);
            border-radius: 8px;
            color: #94a3b8;
            font-size: 1rem;
            font-family: inherit;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .role-btn:hover {
            border-color: rgba(201, 162, 39, 0.5);
            color: #c9a227;
        }

        .role-btn.selected {
            background: rgba(201, 162, 39, 0.15);
            border-color: #c9a227;
            color: #c9a227;
            box-shadow: 0 0 15px rgba(201, 162, 39, 0.2);
        }

        .role-btn .role-icon {
            font-size: 1.5rem;
            display: block;
            margin-bottom: 0.5rem;
        }

        .role-btn .role-label {
            font-weight: 600;
            letter-spacing: 0.1em;
        }

        .role-btn .role-desc {
            font-size: 0.75rem;
            color: #64748b;
            margin-top: 0.3rem;
        }

        .role-btn.selected .role-desc {
            color: #94a3b8;
        }

        /* === æˆåŠŸå¼¹çª— === */
        #success-modal {
            position: fixed;
            inset: 0;
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0, 8, 20, 0.9);
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s ease;
        }

        #success-modal.active {
            opacity: 1;
            pointer-events: auto;
        }

        .modal-content {
            background: linear-gradient(180deg, #0a1628 0%, #001233 100%);
            padding: 3rem 2rem;
            border-radius: 20px;
            text-align: center;
            max-width: 400px;
            margin: 1rem;
            border: 1px solid rgba(201, 162, 39, 0.3);
            box-shadow: 0 0 60px rgba(201, 162, 39, 0.2);
            transform: scale(0.9);
            transition: transform 0.5s ease;
        }

        #success-modal.active .modal-content {
            transform: scale(1);
        }

        .modal-icon {
            font-size: 4rem;
            margin-bottom: 1.5rem;
        }

        .modal-title {
            font-size: 1.5rem;
            color: #c9a227;
            margin-bottom: 1rem;
            line-height: 1.6;
        }

        .modal-text {
            color: #94a3b8;
            margin-bottom: 2rem;
            line-height: 1.8;
        }

        .modal-btn {
            padding: 1rem 3rem;
            background: transparent;
            border: 2px solid #c9a227;
            color: #c9a227;
            font-size: 1rem;
            font-family: inherit;
            letter-spacing: 0.2em;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .modal-btn:hover {
            background: #c9a227;
            color: #000;
        }

        /* === æµ´ä½›æ„ä¹‰è§†é¢‘åŒºåŸŸ === */
        .meaning-videos-section {
            padding: 4rem 1rem;
            background: linear-gradient(180deg, rgba(0, 18, 51, 0.5) 0%, transparent 100%);
        }

        .meaning-videos-title {
            text-align: center;
            font-size: clamp(1.3rem, 4vw, 2rem);
            color: #c9a227;
            margin-bottom: 0.5rem;
            letter-spacing: 0.2em;
        }

        .meaning-videos-subtitle {
            text-align: center;
            color: #64748b;
            margin-bottom: 2.5rem;
            font-size: 0.95rem;
        }

        .meaning-videos-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
        }

        .meaning-video-item {
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(201, 162, 39, 0.2);
            background: rgba(10, 22, 40, 0.6);
        }

        .meaning-video-item iframe {
            width: 100%;
            aspect-ratio: 16/9;
            display: block;
        }

        /* === é¡µè„š === */
        .footer {
            text-align: center;
            padding: 3rem 1rem;
            color: #475569;
            font-size: 0.85rem;
        }

        .footer a {
            color: #c9a227;
            text-decoration: none;
        }

        /* === Canvas (Hidden) === */
        #analysis-canvas {
            display: none;
        }

        /* === Fallback UI === */
        .fallback-ui {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 30;
            background: rgba(10, 22, 40, 0.95);
            padding: 2rem;
            border-radius: 16px;
            border: 1px solid rgba(201, 162, 39, 0.3);
            text-align: center;
            max-width: 400px;
            backdrop-filter: blur(10px);
        }

        .fallback-ui.hidden {
            display: none;
        }

        .fallback-btn {
            display: inline-block;
            padding: 0.8rem 2rem;
            background: linear-gradient(135deg, #b8860b 0%, #c9a227 100%);
            color: #000;
            font-weight: 600;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .fallback-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(201, 162, 39, 0.5);
        }

        /* === æ»šåŠ¨æç¤º === */
        .scroll-indicator {
            position: absolute;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%);
            animation: bounce 2s infinite;
            color: #64748b;
            font-size: 0.85rem;
            text-align: center;
        }

        .scroll-indicator svg {
            display: block;
            margin: 0.5rem auto 0;
            width: 24px;
            height: 24px;
            stroke: #64748b;
        }

        @keyframes bounce {
            0%, 100% { transform: translateX(-50%) translateY(0); }
            50% { transform: translateX(-50%) translateY(10px); }
        }

        /* === Responsive === */
        @media (max-width: 640px) {
            .stats-container {
                flex-direction: column;
                gap: 1rem;
                align-items: stretch;
            }

            .stat-box.right {
                text-align: left;
                border-left: 4px solid #475569;
                border-right: none;
            }

            .form-container {
                padding: 1.5rem;
            }

            .language-buttons {
                flex-direction: column;
                gap: 1rem;
            }

            .lang-btn {
                width: 200px;
            }
        }
    </style>
</head>
<body>
    <!-- å¼€åœºä½›é™€åƒ -->
    <div id="buddha-overlay">
        <img src="buddha.png" alt="Buddha">
    </div>

    <!-- è¯­è¨€é€‰æ‹© -->
    <div id="language-overlay">
        <h2 class="language-title" data-zh="è¯·é€‰æ‹©è¯­è¨€ / Select Language" data-en="Select Language">è¯·é€‰æ‹©è¯­è¨€ / Select Language</h2>
        <div class="language-buttons">
            <button class="lang-btn" onclick="selectLanguage('zh')">ä¸­æ–‡</button>
            <button class="lang-btn" onclick="selectLanguage('en')">English</button>
        </div>
    </div>

    <!-- å±å¹•é—ªå…‰å±‚ -->
    <div id="screen-flash"></div>

    <!-- ä¸»å†…å®¹ -->
    <div id="main-content">
        <!-- Hero Section -->
        <section class="hero-section">
            <h1 class="main-title" data-zh="æ…ˆæµæµ´ä½›" data-en="Tzu Chi Buddha Bathing">æ…ˆæµæµ´ä½›</h1>
            <p class="sub-title" data-zh="ä¸‡äººæµ´ä½› èšç¦ç¼˜" data-en="Ten Thousand People Bathing Buddha, Gathering Blessings">ä¸‡äººæµ´ä½› èšç¦ç¼˜</p>

            <!-- æµ´ä½›æ„ä¹‰æ–‡æ¡ˆ -->
            <div class="ceremony-description">
                <p class="ceremony-text" data-zh="ä»¥å‡€æ°´æ²ä½›ï¼Œæ´—æ¶¤å†…å¿ƒçƒ¦æ¼ï¼›ä»¥å–„å¿µå…±ä¿®ï¼Œå‡èšå’Œå¹³çš„æ„¿åŠ›ã€‚" data-en="Bathe the Buddha with pure water to cleanse inner worries; cultivate together with good intentions to gather the power of peace.">ä»¥å‡€æ°´æ²ä½›ï¼Œæ´—æ¶¤å†…å¿ƒçƒ¦æ¼ï¼›ä»¥å–„å¿µå…±ä¿®ï¼Œå‡èšå’Œå¹³çš„æ„¿åŠ›ã€‚</p>

                <h4 class="ceremony-section-title" data-zh="æµ´ä½›èŠ‚çš„æ„ä¹‰" data-en="Significance of Buddha Bathing">æµ´ä½›èŠ‚çš„æ„ä¹‰</h4>
                <p class="ceremony-text" data-zh="æµ´ä½›è±¡å¾æ´å‡€èº«å¿ƒï¼Œå¿†å¿µä½›é™€æ…ˆæ‚²ä¸æ™ºæ…§ã€‚æ…ˆæµä»¥åº„ä¸¥ä»ªå¼å¼•å¯¼å¤§ä¼—å›å½’æ¸…å‡€ã€å‘æ„¿è¡Œå–„ã€‚" data-en="Buddha Bathing symbolizes purifying body and mind, remembering Buddha's compassion and wisdom. Tzu Chi guides everyone to return to purity and vow to do good through solemn ceremonies.">æµ´ä½›è±¡å¾æ´å‡€èº«å¿ƒï¼Œå¿†å¿µä½›é™€æ…ˆæ‚²ä¸æ™ºæ…§ã€‚æ…ˆæµä»¥åº„ä¸¥ä»ªå¼å¼•å¯¼å¤§ä¼—å›å½’æ¸…å‡€ã€å‘æ„¿è¡Œå–„ã€‚</p>

                <h4 class="ceremony-section-title" data-zh="ä¸‡äººç‚¹ç¯" data-en="Lighting of Ten Thousand Lamps">ä¸‡äººç‚¹ç¯</h4>
                <p class="ceremony-text" data-zh="å½“åƒäººåŒå¿ƒæ’æˆå›¾è…¾ã€ç‚¹äº®å¿ƒç¯ï¼Œæ„¿ç¤¾ä¼šç¥¥å’Œï¼Œäººäººå¹³å®‰ã€‚" data-en="When thousands unite to form a formation and light their heart lamps, may society be harmonious and everyone be at peace.">å½“åƒäººåŒå¿ƒæ’æˆå›¾è…¾ã€ç‚¹äº®å¿ƒç¯ï¼Œæ„¿ç¤¾ä¼šç¥¥å’Œï¼Œäººäººå¹³å®‰ã€‚</p>
            </div>

            <div class="video-section">
                <div class="video-container">
                    <iframe id="promo-video"
                        src="https://www.youtube-nocookie.com/embed/uCESAyzTSlc"
                        title="æ…ˆæµæµ´ä½›å®£ä¼ è§†é¢‘"
                        frameborder="0"
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                        allowfullscreen
                        style="width:100%; aspect-ratio:16/9;">
                    </iframe>
                </div>
            </div>

            <!-- æ´»åŠ¨åœ°å€ä¿¡æ¯ -->
            <div class="event-info">
                <p class="event-date">10.5.2026ï¼ˆæ—¥ï¼‰7am</p>
                <p class="event-venue-zh">æ­¦å‰åŠ é‡Œå°”å›½å®¶æ›²æ£çƒä½“è‚²åœº</p>
                <p class="event-venue-en">National Hockey Stadium, Bukit Jalil</p>
            </div>

            <div class="scroll-indicator" data-zh="å‘ä¸‹æ»‘åŠ¨" data-en="Scroll Down">
                å‘ä¸‹æ»‘åŠ¨
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M7 13l5 5 5-5M7 6l5 5 5-5"/>
                </svg>
            </div>
        </section>

        <!-- å›¾è…¾åŒºåŸŸ -->
        <section class="formation-section">
            <h2 class="section-title" data-zh="ä¸‡äººå›¾è…¾" data-en="Formation of Ten Thousand">ä¸‡äººå›¾è…¾</h2>
            <p class="section-subtitle" data-zh="ç‚¹äº®æ‚¨çš„å¿ƒç¯ï¼Œæ±‡èšå–„å¿µ" data-en="Light your heart lamp, gather blessings">ç‚¹äº®æ‚¨çš„å¿ƒç¯ï¼Œæ±‡èšå–„å¿µ</p>

            <!-- è®¡æ•°å™¨ -->
            <div class="stats-container">
                <div class="stat-box left">
                    <div class="stat-label" data-zh="ç‚¹ç¯æ°‘ä¼—" data-en="Participants">ç‚¹ç¯æ°‘ä¼—</div>
                    <div class="stat-number" id="count-display">0</div>
                </div>
                <div class="stat-box right">
                    <div class="stat-label" data-zh="ç›®æ ‡å‰©ä½™" data-en="Remaining">ç›®æ ‡å‰©ä½™</div>
                    <div class="stat-number" id="remaining-display">6000</div>
                </div>
            </div>

            <!-- SVG å›¾è…¾ -->
            <div class="svg-container">
                <div id="loading-spinner">
                    <div class="spinner"></div>
                    <span data-zh="å›¾è…¾ç”Ÿæˆä¸­..." data-en="Generating formation...">å›¾è…¾ç”Ÿæˆä¸­...</span>
                </div>

                <!-- æ‰‹åŠ¨åŠ è½½å›é€€ UI (é»˜è®¤éšè—ï¼Œåªæœ‰å‡ºé”™æ—¶æ‰æ˜¾ç¤º) -->
                <div id="fallback-ui" class="fallback-ui hidden">
                    <div style="font-size: 2.5rem; margin-bottom: 1rem;">âš ï¸</div>
                    <h3 style="font-size: 1.2rem; color: #fff; margin-bottom: 0.5rem;" data-zh="æœ¬åœ°é¢„è§ˆæ¨¡å¼" data-en="Local Preview Mode">æœ¬åœ°é¢„è§ˆæ¨¡å¼</h3>
                    <p style="color: #94a3b8; font-size: 0.9rem; margin-bottom: 1.5rem; line-height: 1.6;">
                        <span data-zh="æ— æ³•è‡ªåŠ¨è¯»å–å›¾ç‰‡ï¼ˆæµè§ˆå™¨å®‰å…¨é™åˆ¶ï¼‰ã€‚" data-en="Cannot auto-load image (browser security).">æ— æ³•è‡ªåŠ¨è¯»å–å›¾ç‰‡ï¼ˆæµè§ˆå™¨å®‰å…¨é™åˆ¶ï¼‰ã€‚</span><br>
                        <span data-zh="è¯·ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®æ‰‹åŠ¨é€‰æ‹© shape.png" data-en="Please click below to select shape.png">è¯·ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®æ‰‹åŠ¨é€‰æ‹© shape.png</span><br>
                        <span style="color: #c9a227; font-size: 0.75rem;" data-zh="ï¼ˆä¸Šä¼ è‡³ GitHub åå°†è‡ªåŠ¨åŠ è½½ï¼‰" data-en="(Will auto-load after uploading to GitHub)">ï¼ˆä¸Šä¼ è‡³ GitHub åå°†è‡ªåŠ¨åŠ è½½ï¼‰</span>
                    </p>
                    <label class="fallback-btn">
                        <span data-zh="é€‰æ‹© shape.png" data-en="Select shape.png">é€‰æ‹© shape.png</span>
                        <input type="file" id="file-input" accept="image/*" style="display: none;">
                    </label>
                </div>

                <svg id="main-stage" viewBox="0 0 1000 600" preserveAspectRatio="xMidYMid meet">
                    <!-- ç‚¹å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                </svg>
            </div>
        </section>

        <!-- æŠ¥ååŒºåŸŸ -->
        <section class="registration-section">
            <div class="form-container">
                <h3 class="form-title" data-zh="æŠ¥åå‚ä¸" data-en="Register Now">æŠ¥åå‚ä¸</h3>
                <p class="form-subtitle" data-zh="å¡«å†™ä»¥ä¸‹èµ„æ–™å®ŒæˆæŠ¥å" data-en="Fill in the form to register">å¡«å†™ä»¥ä¸‹èµ„æ–™å®ŒæˆæŠ¥å</p>

                <form id="registration-form">
                    <div class="form-group">
                        <label data-zh="å§“å" data-en="Name">å§“å</label>
                        <input type="text" class="form-input" id="name" required
                               data-placeholder-zh="è¯·è¾“å…¥æ‚¨çš„å§“å"
                               data-placeholder-en="Enter your name"
                               placeholder="è¯·è¾“å…¥æ‚¨çš„å§“å">
                    </div>

                    <div class="form-group">
                        <label data-zh="æ‰‹æœºå·ç " data-en="Phone Number">æ‰‹æœºå·ç </label>
                        <input type="tel" class="form-input" id="phone" required
                               data-placeholder-zh="è¯·è¾“å…¥æ‰‹æœºå·ç "
                               data-placeholder-en="Enter your phone number"
                               placeholder="è¯·è¾“å…¥æ‰‹æœºå·ç ">
                    </div>

                    <div class="form-group">
                        <label data-zh="å±…ä½åŒºåŸŸï¼ˆè¯·é€‰æ‹©æœ€é è¿‘æ‚¨ä½å¤„çš„åŒºåŸŸï¼‰" data-en="Region (Please select the region closest to your residence)">å±…ä½åŒºåŸŸï¼ˆè¯·é€‰æ‹©æœ€é è¿‘æ‚¨ä½å¤„çš„åŒºåŸŸï¼‰</label>
                        <select class="form-input" id="region" required>
                            <option value="" data-zh="è¯·é€‰æ‹©åŒºåŸŸ" data-en="Select region">è¯·é€‰æ‹©åŒºåŸŸ</option>

                            <optgroup label="å’Œæ°”äº’çˆ±" data-label-zh="å’Œæ°”äº’çˆ±" data-label-en="Heqi Huai">
                                <option value="å’Œæ°”äº’çˆ±" data-zh="å’Œæ°”äº’çˆ±" data-en="Heqi Huai">å’Œæ°”äº’çˆ±</option>
                            </optgroup>

                            <optgroup label="ä¸œåŒº" data-label-zh="ä¸œåŒº" data-label-en="East">
                                <option value="ä¸œ1-åŠ å½±" data-zh="ä¸œ1 - åŠ å½±" data-en="East 1 - Kajang">ä¸œ1 - åŠ å½±</option>
                                <option value="ä¸œ1-åŒæºªé¾™é•‡" data-zh="ä¸œ1 - åŒæºªé¾™é•‡" data-en="East 1 - Bandar Sungai Long">ä¸œ1 - åŒæºªé¾™é•‡</option>
                                <option value="ä¸œ2-å¤§åŒ" data-zh="ä¸œ2 - å¤§åŒ" data-en="East 2 - Taman Connaught">ä¸œ2 - å¤§åŒ</option>
                                <option value="ä¸œ2-å¤ªå­å›­" data-zh="ä¸œ2 - å¤ªå­å›­" data-en="East 2 - Taman Putra">ä¸œ2 - å¤ªå­å›­</option>
                                <option value="ä¸œ2-å®‰é‚¦" data-zh="ä¸œ2 - å®‰é‚¦" data-en="East 2 - Ampang">ä¸œ2 - å®‰é‚¦</option>
                            </optgroup>

                            <optgroup label="ä¸­åŒº" data-label-zh="ä¸­åŒº" data-label-en="Central">
                                <option value="ä¸­1-å¤§åŸå ¡" data-zh="ä¸­1 - å¤§åŸå ¡" data-en="Central 1 - Sri Petaling">ä¸­1 - å¤§åŸå ¡</option>
                                <option value="ä¸­1-æ—§å·´ç”Ÿè·¯" data-zh="ä¸­1 - æ—§å·´ç”Ÿè·¯" data-en="Central 1 - Old Klang Road">ä¸­1 - æ—§å·´ç”Ÿè·¯</option>
                                <option value="ä¸­2-æ²™ç™»æ–°åŒº" data-zh="ä¸­2 - æ²™ç™»æ–°åŒº" data-en="Central 2 - Seri Kembangan">ä¸­2 - æ²™ç™»æ–°åŒº</option>
                                <option value="ä¸­2-æ²™ç™»æ—§åŒº" data-zh="ä¸­2 - æ²™ç™»æ—§åŒº" data-en="Central 2 - Serdang Lama">ä¸­2 - æ²™ç™»æ—§åŒº</option>
                                <option value="ä¸­3-è’²ç§åŸ" data-zh="ä¸­3 - è’²ç§åŸ" data-en="Central 3 - Bandar Puchong">ä¸­3 - è’²ç§åŸ</option>
                                <option value="ä¸­3-è’²ç§å¸‚" data-zh="ä¸­3 - è’²ç§å¸‚" data-en="Central 3 - Puchong Jaya">ä¸­3 - è’²ç§å¸‚</option>
                                <option value="ä¸­3-è’²ç§éƒ½" data-zh="ä¸­3 - è’²ç§éƒ½" data-en="Central 3 - Puchong Utama">ä¸­3 - è’²ç§éƒ½</option>
                                <option value="ä¸­3-è’²ç§é•‡" data-zh="ä¸­3 - è’²ç§é•‡" data-en="Central 3 - Taman Puchong">ä¸­3 - è’²ç§é•‡</option>
                                <option value="ä¸­4-å¸ƒé«˜åŸ" data-zh="ä¸­4 - å¸ƒé«˜åŸ" data-en="Central 4 - Putra Heights">ä¸­4 - å¸ƒé«˜åŸ</option>
                                <option value="ä¸­4-æ¢³é‚¦å†ä¹Ÿ" data-zh="ä¸­4 - æ¢³é‚¦å†ä¹Ÿ" data-en="Central 4 - Subang Jaya">ä¸­4 - æ¢³é‚¦å†ä¹Ÿ</option>
                                <option value="ä¸­5-æ­¦å‰æ—¥è½æ´" data-zh="ä¸­5 - æ­¦å‰æ—¥è½æ´" data-en="Central 5 - Bukit Jalil">ä¸­5 - æ­¦å‰æ—¥è½æ´</option>
                                <option value="ä¸­5-èäºšå—" data-zh="ä¸­5 - èäºšå—" data-en="Central 5 - Shah Alam">ä¸­5 - èäºšå—</option>
                            </optgroup>

                            <optgroup label="åŒ—åŒº" data-label-zh="åŒ—åŒº" data-label-en="North">
                                <option value="åŒ—1-SVD" data-zh="åŒ—1 - SVD" data-en="North 1 - SVD">åŒ—1 - SVD</option>
                                <option value="åŒ—1-ä¸‡æŒ " data-zh="åŒ—1 - ä¸‡æŒ " data-en="North 1 - Rawang">åŒ—1 - ä¸‡æŒ </option>
                                <option value="åŒ—1-æ–¯é‡Œç™½æ²™ç½—" data-zh="åŒ—1 - æ–¯é‡Œç™½æ²™ç½—" data-en="North 1 - Sri Damansara">åŒ—1 - æ–¯é‡Œç™½æ²™ç½—</option>
                                <option value="åŒ—2-å…«æ‰“çµ" data-zh="åŒ—2 - å…«æ‰“çµ" data-en="North 2 - Petaling Jaya">åŒ—2 - å…«æ‰“çµ</option>
                                <option value="åŒ—2-ç™½æ²™ç½—" data-zh="åŒ—2 - ç™½æ²™ç½—" data-en="North 2 - Damansara">åŒ—2 - ç™½æ²™ç½—</option>
                                <option value="åŒ—B-å¢æ±Ÿ" data-zh="åŒ—B - å¢æ±Ÿ" data-en="North B - Jinjang">åŒ—B - å¢æ±Ÿ</option>
                                <option value="åŒ—B-å³‡éƒ½æ€¥" data-zh="åŒ—B - å³‡éƒ½æ€¥" data-en="North B - Batu Caves">åŒ—B - å³‡éƒ½æ€¥</option>
                                <option value="åŒ—B-æ–‡è‰¯æ¸¯" data-zh="åŒ—B - æ–‡è‰¯æ¸¯" data-en="North B - Setapak">åŒ—B - æ–‡è‰¯æ¸¯</option>
                                <option value="åŒ—B-æ—ºæ²™ç›ç " data-zh="åŒ—B - æ—ºæ²™ç›ç " data-en="North B - Wangsa Maju">åŒ—B - æ—ºæ²™ç›ç </option>
                                <option value="åŒ—B-ç”²æ´å«æ˜Ÿå¸‚" data-zh="åŒ—B - ç”²æ´å«æ˜Ÿå¸‚" data-en="North B - Kepong Baru">åŒ—B - ç”²æ´å«æ˜Ÿå¸‚</option>
                                <option value="åŒ—B-ç”²æ´å¸æ²™" data-zh="åŒ—B - ç”²æ´å¸æ²™" data-en="North B - Desa Jaya">åŒ—B - ç”²æ´å¸æ²™</option>
                                <option value="åŒ—B-ç”²æ´é©¬é²é‡Œ" data-zh="åŒ—B - ç”²æ´é©¬é²é‡Œ" data-en="North B - Metro Prima">åŒ—B - ç”²æ´é©¬é²é‡Œ</option>
                            </optgroup>

                            <optgroup label="è¥¿åŒ—åŒº" data-label-zh="è¥¿åŒ—åŒº" data-label-en="Northwest">
                                <option value="è¥¿åŒ—-åŠ åŸ”å«æ˜Ÿå¸‚" data-zh="è¥¿åŒ— - åŠ åŸ”å«æ˜Ÿå¸‚" data-en="Northwest - Kapar">è¥¿åŒ— - åŠ åŸ”å«æ˜Ÿå¸‚</option>
                                <option value="è¥¿åŒ—-å®è¾¾é˜¿å—" data-zh="è¥¿åŒ— - å®è¾¾é˜¿å—" data-en="Northwest - Setia Alam">è¥¿åŒ— - å®è¾¾é˜¿å—</option>
                                <option value="è¥¿åŒ—-æ°¸å®‰é•‡" data-zh="è¥¿åŒ— - æ°¸å®‰é•‡" data-en="Northwest - Bandar Bukit Raja">è¥¿åŒ— - æ°¸å®‰é•‡</option>
                                <option value="è¥¿åŒ—-é€‚è€•åº„å¤§æ¸¯" data-zh="è¥¿åŒ— - é€‚è€•åº„å¤§æ¸¯" data-en="Northwest - Sekinchan">è¥¿åŒ— - é€‚è€•åº„å¤§æ¸¯</option>
                            </optgroup>

                            <optgroup label="è¥¿å—åŒº" data-label-zh="è¥¿å—åŒº" data-label-en="Southwest">
                                <option value="è¥¿å—1-åœ£æ·˜æ²™" data-zh="è¥¿å—1 - åœ£æ·˜æ²™" data-en="Southwest 1 - Kota Kemuning">è¥¿å—1 - åœ£æ·˜æ²™</option>
                                <option value="è¥¿å—1-å¿«ä¹å›­" data-zh="è¥¿å—1 - å¿«ä¹å›­" data-en="Southwest 1 - Taman Sentosa">è¥¿å—1 - å¿«ä¹å›­</option>
                                <option value="è¥¿å—2-æ­¦å‰ä¸å®œ" data-zh="è¥¿å—2 - æ­¦å‰ä¸å®œ" data-en="Southwest 2 - Bukit Tinggi">è¥¿å—2 - æ­¦å‰ä¸å®œ</option>
                                <option value="è¥¿å—2-ä¸‡ç»’" data-zh="è¥¿å—2 - ä¸‡ç»’" data-en="Southwest 2 - Bandar Botanic">è¥¿å—2 - ä¸‡ç»’</option>
                            </optgroup>

                            <optgroup label="åŠŸèƒ½ç»„" data-label-zh="åŠŸèƒ½ç»„" data-label-en="Functional Group">
                                <option value="åŠŸèƒ½ç»„" data-zh="åŠŸèƒ½ç»„" data-en="Functional Group">åŠŸèƒ½ç»„</option>
                                <option value="åŠŸèƒ½ç»„-è‹±æ–‡ç»„" data-zh="åŠŸèƒ½ç»„ - è‹±æ–‡ç»„" data-en="Functional Group - English">åŠŸèƒ½ç»„ - è‹±æ–‡ç»„</option>
                                <option value="åŠŸèƒ½ç»„-åŒ»ç–—ç»„" data-zh="åŠŸèƒ½ç»„ - åŒ»ç–—ç»„" data-en="Functional Group - Medical">åŠŸèƒ½ç»„ - åŒ»ç–—ç»„</option>
                            </optgroup>

                            <optgroup label="åˆå¿ƒ" data-label-zh="åˆå¿ƒ" data-label-en="Hexin">
                                <option value="åˆå¿ƒ-åŠŸèƒ½ç»„" data-zh="åˆå¿ƒ - åŠŸèƒ½ç»„" data-en="Hexin - Functional Group">åˆå¿ƒ - åŠŸèƒ½ç»„</option>
                                <option value="åˆå¿ƒ-è’²ç§å¸‚" data-zh="åˆå¿ƒ - è’²ç§å¸‚" data-en="Hexin - Puchong Jaya">åˆå¿ƒ - è’²ç§å¸‚</option>
                            </optgroup>
                        </select>
                    </div>

                    <!-- è§’è‰²é€‰æ‹© -->
                    <div class="role-selection">
                        <label data-zh="ä½ æƒ³æˆä¸º" data-en="I want to be">ä½ æƒ³æˆä¸º</label>
                        <div class="role-buttons">
                            <button type="button" class="role-btn" id="role-audience" onclick="selectRole('audience')">
                                <span class="role-icon">ğŸ‘€</span>
                                <span class="role-label" data-zh="è§‚ç¤¼å½“è§‚ä¼—" data-en="Be an Audience">è§‚ç¤¼å½“è§‚ä¼—</span>
                                <span class="role-desc" data-zh="ç°åœºè§‚ç¤¼" data-en="Watch the ceremony">ç°åœºè§‚ç¤¼</span>
                            </button>
                            <button type="button" class="role-btn" id="role-formation" onclick="selectRole('formation')">
                                <span class="role-icon">ğŸª·</span>
                                <span class="role-label" data-zh="å…¥åº„ä¸¥å›¾å½¢" data-en="Join Formation">å…¥åº„ä¸¥å›¾å½¢</span>
                                <span class="role-desc" data-zh="èå…¥å¤§æˆ‘" data-en="Become part of the whole">èå…¥å¤§æˆ‘</span>
                            </button>
                        </div>
                        <input type="hidden" id="role" name="role" required>
                    </div>

                    <button type="submit" class="submit-btn" id="submit-btn"
                            data-zh="å‘ˆäº¤ç¥ˆæ„¿" data-en="Submit Prayer">å‘ˆäº¤ç¥ˆæ„¿</button>
                </form>
            </div>
        </section>

        <!-- æµ´ä½›æ„ä¹‰è§†é¢‘åŒºåŸŸ -->
        <section class="meaning-videos-section">
            <h2 class="meaning-videos-title" data-zh="æµ´ä½›èŠ‚çš„æ„ä¹‰" data-en="Significance of Buddha Bathing">æµ´ä½›èŠ‚çš„æ„ä¹‰</h2>
            <p class="meaning-videos-subtitle" data-zh="äº†è§£æ›´å¤šå…³äºæµ´ä½›èŠ‚çš„æ„ä¹‰" data-en="Learn more about the significance of Buddha Bathing">äº†è§£æ›´å¤šå…³äºæµ´ä½›èŠ‚çš„æ„ä¹‰</p>

            <div class="meaning-videos-container">
                <div class="meaning-video-item">
                    <iframe
                        src="https://www.youtube-nocookie.com/embed/PqKX4WgakbQ"
                        title="æµ´ä½›èŠ‚æ„ä¹‰è§†é¢‘1"
                        frameborder="0"
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                        allowfullscreen>
                    </iframe>
                </div>
                <div class="meaning-video-item">
                    <iframe
                        src="https://www.youtube-nocookie.com/embed/LdL_vymXnlc"
                        title="æµ´ä½›èŠ‚æ„ä¹‰è§†é¢‘2"
                        frameborder="0"
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                        allowfullscreen>
                    </iframe>
                </div>
                <div class="meaning-video-item">
                    <iframe
                        src="https://www.youtube-nocookie.com/embed/ggAxSXqViYI"
                        title="æµ´ä½›èŠ‚æ„ä¹‰è§†é¢‘3"
                        frameborder="0"
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                        allowfullscreen>
                    </iframe>
                </div>
            </div>
        </section>

        <!-- é¡µè„š -->
        <footer class="footer">
            <p>å°æ¹¾ä½›æ•™æ…ˆæµåŸºé‡‘ä¼šé©¬æ¥è¥¿äºšï¼ˆé›ªéš†åˆ†ä¼šï¼‰</p>
            <p style="margin-top: 0.5rem;">Taiwan Buddhist Tzu-Chi Foundation Malaysia (KL & Selangor)</p>
        </footer>
    </div>

    <!-- æˆåŠŸå¼¹çª— -->
    <div id="success-modal">
        <div class="modal-content">
            <div class="modal-icon">ğŸ™</div>
            <h3 class="modal-title" data-zh="æ„Ÿæ©æŠ¥å" data-en="Thank You for Registering">æ„Ÿæ©æŠ¥å</h3>
            <p class="modal-text" data-zh="æˆ‘ä»¬ä¼šå°½å¿«ä¸æ‚¨è”ç³»" data-en="We will contact you soon">æˆ‘ä»¬ä¼šå°½å¿«ä¸æ‚¨è”ç³»</p>
            <button class="modal-btn" onclick="closeModal()" data-zh="å…³é—­" data-en="Close">å…³é—­</button>
        </div>
    </div>

    <!-- Hidden Canvas -->
    <canvas id="analysis-canvas"></canvas>

    <script>
        // === é…ç½® ===
        const CONFIG = {
            totalDots: 6000,
            targetCount: 6000,
            storageKey: 'tzuchi_yufo_2026_v1',
            imagePath: 'shape.png'
        };

        // === çŠ¶æ€ ===
        let state = {
            count: parseInt(localStorage.getItem(CONFIG.storageKey)) || 0,
            dots: [],
            availableIndices: [],
            language: 'zh'
        };

        // === DOM å…ƒç´  ===
        const ui = {
            buddhaOverlay: document.getElementById('buddha-overlay'),
            languageOverlay: document.getElementById('language-overlay'),
            mainContent: document.getElementById('main-content'),
            stage: document.getElementById('main-stage'),
            countDisplay: document.getElementById('count-display'),
            remainingDisplay: document.getElementById('remaining-display'),
            form: document.getElementById('registration-form'),
            submitBtn: document.getElementById('submit-btn'),
            modal: document.getElementById('success-modal'),
            spinner: document.getElementById('loading-spinner'),
            screenFlash: document.getElementById('screen-flash'),
            video: document.getElementById('promo-video'),
            fallback: document.getElementById('fallback-ui'),
            fileInput: document.getElementById('file-input')
        };

        // === å¼€åœºåŠ¨ç”»åºåˆ— ===
        function startIntroSequence() {
            // ä½›é™€åƒæ˜¾ç¤º 1.5 ç§’ï¼Œè®©ç”¨æˆ·å……åˆ†æ„Ÿå—åº„ä¸¥
            setTimeout(() => {
                ui.buddhaOverlay.classList.add('fade-out');

                // è™šåŒ–è¿‡æ¸¡ 2.5 ç§’åæ˜¾ç¤ºè¯­è¨€é€‰æ‹©
                setTimeout(() => {
                    ui.buddhaOverlay.style.display = 'none';
                    ui.languageOverlay.classList.add('active');
                }, 2500);
            }, 1500);
        }

        // === è¯­è¨€é€‰æ‹© ===
        function selectLanguage(lang) {
            state.language = lang;
            localStorage.setItem('tzuchi_language', lang);

            ui.languageOverlay.classList.add('fade-out');

            setTimeout(() => {
                ui.languageOverlay.style.display = 'none';
                ui.mainContent.classList.add('active');

                // åº”ç”¨è¯­è¨€
                applyLanguage(lang);

                // YouTube iframe ä¸éœ€è¦è‡ªåŠ¨æ’­æ”¾æ§åˆ¶ï¼Œç”±ç”¨æˆ·ç‚¹å‡»æ’­æ”¾

                // åˆå§‹åŒ–å›¾è…¾
                initFormation();
            }, 600);
        }

        // === åº”ç”¨è¯­è¨€ ===
        function applyLanguage(lang) {
            const attr = `data-${lang}`;

            // æ›´æ–°æ‰€æœ‰å¸¦è¯­è¨€å±æ€§çš„å…ƒç´ 
            document.querySelectorAll(`[${attr}]`).forEach(el => {
                el.textContent = el.getAttribute(attr);
            });

            // æ›´æ–° placeholder
            document.querySelectorAll('[data-placeholder-zh]').forEach(el => {
                const placeholderAttr = `data-placeholder-${lang}`;
                if (el.hasAttribute(placeholderAttr)) {
                    el.placeholder = el.getAttribute(placeholderAttr);
                }
            });

            // æ›´æ–°åŒºåŸŸé€‰æ‹©ä¸‹æ‹‰èœå•çš„é€‰é¡¹æ–‡å­—
            const regionSelect = document.getElementById('region');
            if (regionSelect) {
                // æ›´æ–° optgroup æ ‡ç­¾
                regionSelect.querySelectorAll('optgroup').forEach(group => {
                    const labelAttr = `data-label-${lang}`;
                    if (group.hasAttribute(labelAttr)) {
                        group.label = group.getAttribute(labelAttr);
                    }
                });

                // æ›´æ–° option æ–‡å­—
                regionSelect.querySelectorAll('option').forEach(option => {
                    if (option.hasAttribute(attr)) {
                        option.textContent = option.getAttribute(attr);
                    }
                });
            }

            // æ›´æ–° HTML lang å±æ€§
            document.documentElement.lang = lang === 'zh' ? 'zh-CN' : 'en';
        }

        // === åˆå§‹åŒ–å›¾è…¾ ===
        function initFormation() {
            updateStats();

            const img = new Image();
            img.crossOrigin = "Anonymous";

            img.onload = () => processImage(img);
            img.onerror = () => {
                // è‡ªåŠ¨åŠ è½½å¤±è´¥ï¼Œæ˜¾ç¤ºæ‰‹åŠ¨é€‰æ‹©æŒ‰é’®
                console.log('è‡ªåŠ¨åŠ è½½å¤±è´¥ (CORS/Path)ï¼Œåˆ‡æ¢è‡³æ‰‹åŠ¨æ¨¡å¼');
                ui.spinner.style.display = 'none';
                ui.fallback.classList.remove('hidden');
            };

            img.src = CONFIG.imagePath;
        }

        // === ç›‘å¬æ‰‹åŠ¨é€‰æ‹©æ–‡ä»¶ ===
        ui.fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                ui.fallback.classList.add('hidden');
                ui.spinner.style.display = 'block';

                const reader = new FileReader();
                reader.onload = (event) => {
                    const img = new Image();
                    img.onload = () => processImage(img);
                    img.src = event.target.result;
                };
                reader.readAsDataURL(file);
            }
        });

        // === å¤„ç†å›¾ç‰‡ ===
        function processImage(img) {
            setTimeout(() => {
                const canvas = document.getElementById('analysis-canvas');
                const ctx = canvas.getContext('2d');

                const w = 1000;
                const h = 600;
                canvas.width = w;
                canvas.height = h;

                // ç»˜åˆ¶ç™½è‰²èƒŒæ™¯
                ctx.fillStyle = "#FFFFFF";
                ctx.fillRect(0, 0, w, h);

                // è®¡ç®—ç¼©æ”¾æ¯”ä¾‹ä¿æŒå›¾ç‰‡æ¯”ä¾‹
                const scale = Math.min(w / img.width, h / img.height) * 0.98;
                const drawW = img.width * scale;
                const drawH = img.height * scale;
                const offsetX = (w - drawW) / 2;
                const offsetY = (h - drawH) / 2;

                // ç»˜åˆ¶å›¾ç‰‡
                ctx.drawImage(img, offsetX, offsetY, drawW, drawH);

                const imageData = ctx.getImageData(0, 0, w, h);
                const data = imageData.data;
                const darkPixels = [];

                // é‡‡æ ·æ·±è‰²åƒç´  - Shape.png æ˜¯ä½“è‚²åœºä¿¯è§†å›¾
                // èƒŒæ™¯æ˜¯æµ…ç°è‰²ï¼Œå›¾è…¾éƒ¨åˆ†æ˜¯æ·±è‰²/é»‘è‰²ç‚¹
                for (let y = 0; y < h; y += 2) {
                    for (let x = 0; x < w; x += 2) {
                        const i = (y * w + x) * 4;
                        const r = data[i];
                        const g = data[i + 1];
                        const b = data[i + 2];
                        const alpha = data[i + 3];

                        // è¯†åˆ«æ·±è‰²åŒºåŸŸï¼ˆè²èŠ±å›¾è…¾çš„ç‚¹é˜µéƒ¨åˆ†ï¼‰
                        // Shape.png èƒŒæ™¯çº¦ 200+ï¼Œå›¾è…¾æ·±è‰²éƒ¨åˆ†çº¦ 0-180
                        if (alpha > 128 && r < 180 && g < 180 && b < 180) {
                            darkPixels.push({ x, y });
                        }
                    }
                }

                console.log('è¯†åˆ«åˆ°æ·±è‰²åƒç´ æ•°é‡:', darkPixels.length);

                if (darkPixels.length > 100) {
                    generateDotsFromPixels(darkPixels);
                } else {
                    console.log('åƒç´ æ•°é‡ä¸è¶³ï¼Œä½¿ç”¨å¤‡ç”¨æ–¹æ¡ˆ');
                    generateFallbackDots();
                }
            }, 300);
        }

        // === ä»åƒç´ ç”Ÿæˆç‚¹ ===
        function generateDotsFromPixels(pixelPool) {
            const fragment = document.createDocumentFragment();
            state.dots = [];
            state.availableIndices = [];

            for (let i = 0; i < CONFIG.totalDots; i++) {
                let p;
                if (pixelPool.length > 0) {
                    const randIndex = Math.floor(Math.random() * pixelPool.length);
                    p = pixelPool[randIndex];
                    // æ·»åŠ å¾®å°æŠ–åŠ¨
                    p = {
                        x: p.x + (Math.random() - 0.5) * 4,
                        y: p.y + (Math.random() - 0.5) * 4
                    };
                } else {
                    p = { x: 500, y: 300 };
                }

                const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                circle.setAttribute("cx", p.x.toFixed(1));
                circle.setAttribute("cy", p.y.toFixed(1));

                // éšæœºå¤§å°
                const r = 1.0 + Math.random() * 0.6;
                circle.setAttribute("r", r);
                circle.setAttribute("class", "dot");

                fragment.appendChild(circle);

                state.dots.push({
                    el: circle,
                    x: p.x,
                    y: p.y
                });
            }

            // éšæœºåŒ–ç´¢å¼•é¡ºåº
            const indices = Array.from({ length: CONFIG.totalDots }, (_, k) => k);
            shuffleArray(indices);
            state.availableIndices = indices;

            // æ¸²æŸ“
            ui.stage.innerHTML = '';
            ui.stage.appendChild(fragment);

            // éšè—åŠ è½½ï¼Œæ˜¾ç¤ºå›¾è…¾
            ui.spinner.style.display = 'none';
            ui.stage.style.opacity = '1';

            // æ¢å¤å·²ç‚¹äº®çš„ç‚¹
            restoreProgress();
        }

        // === å¤‡ç”¨æ–¹æ¡ˆï¼šç”Ÿæˆåœ†å½¢ç‚¹é˜µ ===
        function generateFallbackDots() {
            const fragment = document.createDocumentFragment();
            state.dots = [];
            state.availableIndices = [];

            const centerX = 500;
            const centerY = 300;
            const maxRadius = 250;

            for (let i = 0; i < CONFIG.totalDots; i++) {
                // éšæœºè§’åº¦å’ŒåŠå¾„ï¼ˆæ›´å¯†é›†åœ¨ä¸­å¿ƒï¼‰
                const angle = Math.random() * Math.PI * 2;
                const radius = Math.sqrt(Math.random()) * maxRadius;
                const x = centerX + Math.cos(angle) * radius;
                const y = centerY + Math.sin(angle) * radius;

                const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                circle.setAttribute("cx", x.toFixed(1));
                circle.setAttribute("cy", y.toFixed(1));
                circle.setAttribute("r", 1.0 + Math.random() * 0.6);
                circle.setAttribute("class", "dot");

                fragment.appendChild(circle);
                state.dots.push({ el: circle, x, y });
            }

            const indices = Array.from({ length: CONFIG.totalDots }, (_, k) => k);
            shuffleArray(indices);
            state.availableIndices = indices;

            ui.stage.innerHTML = '';
            ui.stage.appendChild(fragment);
            ui.spinner.style.display = 'none';
            ui.stage.style.opacity = '1';

            restoreProgress();
        }

        // === å·¥å…·å‡½æ•°ï¼šéšæœºæ‰“ä¹±æ•°ç»„ ===
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        // === æ›´æ–°ç»Ÿè®¡æ•°å­— ===
        function updateStats() {
            ui.countDisplay.textContent = state.count;
            const remaining = CONFIG.targetCount - state.count;
            ui.remainingDisplay.textContent = Math.max(0, remaining);
        }

        // === æ¢å¤å·²ç‚¹äº®çš„è¿›åº¦ ===
        function restoreProgress() {
            for (let i = 0; i < state.count && i < state.availableIndices.length; i++) {
                const dotIndex = state.availableIndices[i];
                const dot = state.dots[dotIndex];
                if (dot) {
                    dot.el.classList.add('active');
                }
            }
        }

        // === è§’è‰²é€‰æ‹© ===
        function selectRole(role) {
            // ç§»é™¤æ‰€æœ‰é€‰ä¸­çŠ¶æ€
            document.querySelectorAll('.role-btn').forEach(btn => {
                btn.classList.remove('selected');
            });

            // è®¾ç½®é€‰ä¸­çŠ¶æ€
            const selectedBtn = document.getElementById(`role-${role}`);
            if (selectedBtn) {
                selectedBtn.classList.add('selected');
            }

            // æ›´æ–°éšè—è¾“å…¥æ¡†
            document.getElementById('role').value = role;
        }

        // === è·å–æ‰€æœ‰æŠ¥åæ•°æ®ï¼ˆç”¨äºæœªæ¥åç«¯é›†æˆï¼‰ ===
        function getStoredRegistrations() {
            const stored = localStorage.getItem('tzuchi_yufo_2026_registrations');
            return stored ? JSON.parse(stored) : [];
        }

        // === ä¿å­˜æŠ¥åæ•°æ®ï¼ˆç”¨äºæœªæ¥åç«¯é›†æˆï¼‰ ===
        function saveRegistration(data) {
            const registrations = getStoredRegistrations();
            registrations.push(data);
            localStorage.setItem('tzuchi_yufo_2026_registrations', JSON.stringify(registrations));

            // æœªæ¥å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ  API è°ƒç”¨
            // ä¾‹å¦‚: await fetch('/api/register', { method: 'POST', body: JSON.stringify(data) });

            return data;
        }

        // === è¡¨å•æäº¤ ===
        ui.form.addEventListener('submit', (e) => {
            e.preventDefault();

            const name = document.getElementById('name').value.trim();
            const phone = document.getElementById('phone').value.trim();
            const region = document.getElementById('region').value;
            const role = document.getElementById('role').value;

            // éªŒè¯æ‰€æœ‰å¿…å¡«é¡¹
            if (!name || !phone || !region) return;

            // éªŒè¯è§’è‰²é€‰æ‹©
            if (!role) {
                alert(state.language === 'zh' ? 'è¯·é€‰æ‹©ã€Œè§‚ç¤¼å½“è§‚ä¼—ã€æˆ–ã€Œå…¥åº„ä¸¥å›¾å½¢ã€' : 'Please select "Be an Audience" or "Join Formation"');
                return;
            }

            // ç¦ç”¨æŒ‰é’®
            ui.submitBtn.disabled = true;
            ui.submitBtn.textContent = state.language === 'zh' ? 'å¤„ç†ä¸­...' : 'Processing...';

            // å‡†å¤‡æŠ¥åæ•°æ®
            const formData = {
                id: Date.now().toString(36) + Math.random().toString(36).substr(2, 5),
                name,
                phone,
                region,
                role,  // 'audience' æˆ– 'formation'
                roleLabel: role === 'audience' ? 'è§‚ç¤¼å½“è§‚ä¼—' : 'å…¥åº„ä¸¥å›¾å½¢',
                language: state.language,
                timestamp: new Date().toISOString()
            };

            // ä¿å­˜åˆ° localStorageï¼ˆæ–¹ä¾¿æœªæ¥åç«¯é›†æˆï¼‰
            saveRegistration(formData);
            console.log('æŠ¥åæ•°æ®å·²ä¿å­˜:', formData);
            console.log('æ‰€æœ‰æŠ¥åæ•°æ®:', getStoredRegistrations());

            // å¼€å§‹åŠ¨ç”»
            startLightingAnimation(() => {
                // æ›´æ–°è®¡æ•°
                state.count++;
                localStorage.setItem(CONFIG.storageKey, state.count);
                updateStats();

                // é‡ç½®è¡¨å•
                ui.form.reset();
                document.querySelectorAll('.role-btn').forEach(btn => btn.classList.remove('selected'));
                document.getElementById('role').value = '';
                ui.submitBtn.disabled = false;
                ui.submitBtn.textContent = state.language === 'zh' ? 'å‘ˆäº¤ç¥ˆæ„¿' : 'Submit Prayer';

                // æ˜¾ç¤ºæˆåŠŸå¼¹çª—
                ui.modal.classList.add('active');
            });
        });

        // === ç‚¹ç¯åŠ¨ç”» ===
        function startLightingAnimation(callback) {
            const nextIndexPtr = state.count;

            if (nextIndexPtr >= state.availableIndices.length) {
                alert(state.language === 'zh' ? 'åŠŸå¾·åœ†æ»¡ï¼' : 'All positions filled!');
                callback();
                return;
            }

            const targetDotIndex = state.availableIndices[nextIndexPtr];
            const targetDot = state.dots[targetDotIndex];

            // å…ˆæ»šåŠ¨åˆ°å›¾è…¾ä½ç½®
            ui.stage.scrollIntoView({ behavior: 'smooth', block: 'center' });

            setTimeout(() => {
                // å…¨å›¾é—ªå…‰
                ui.stage.classList.add('flash-mode');
                ui.screenFlash.classList.add('active');

                // ç‚¹äº®ç›®æ ‡ç‚¹
                targetDot.el.classList.add('active');

                // ç»´æŒé—ªå…‰ 1.2 ç§’
                setTimeout(() => {
                    // ç§»é™¤é—ªå…‰ï¼Œå¼€å§‹æ”¶ç¼©
                    ui.stage.classList.remove('flash-mode');
                    ui.screenFlash.classList.remove('active');

                    // ç­‰å¾…æ”¶ç¼©åŠ¨ç”»å®Œæˆåå›è°ƒ
                    setTimeout(() => {
                        callback();
                    }, 1500);

                }, 1200);

            }, 500);
        }

        // === å…³é—­å¼¹çª— ===
        function closeModal() {
            ui.modal.classList.remove('active');
        }

        // === é¡µé¢åŠ è½½å®Œæˆåå¯åŠ¨ ===
        window.onload = () => {
            startIntroSequence();
        };

        // === ç‚¹å‡»å¼¹çª—å¤–éƒ¨å…³é—­ ===
        ui.modal.addEventListener('click', (e) => {
            if (e.target === ui.modal) {
                closeModal();
            }
        });
    </script>
</body>
</html>
